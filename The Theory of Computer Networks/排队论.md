# 综述
## 输入
信息包的输入可以是无穷也可以是有限的.
信息包可以是成批到达的, 也可以是单个到达的
信息包到达的时间间隔所服从的分布(常见负指数分布, k阶埃尔朗分布)

**Th**: 在排队系统中, 如果单位时间内到达的信息包数服从以 $\lambda$ 为参数的泊松分布, 则信息包相继到达的时间间隔服从以 $\lambda$ 为参数的负指数分布

## 排队规则
排队模式: 等待制(没有轮到就等)和损失制(没有轮到就不等)
排队队列: 单列和多列
排队规则：
- 先到先服务(FCFS)
- 后到先服务(LCFS)
- 随机服务(SIRO)
- 优先服务(PR)

## 服务机构
单服务台,
多服务台:
- 单对单服务(1:1) 
- 单对多服务(1:n)并联式
- 多对多(n:n)并联式(n个1:1)
- 单对单服务串联式(一个接一个)
- 单对多串并联混合式

## 模型符号表示
$A/B/C/D/E/F$ 其中
- A: 信息包到达时间间隔分布: 负指数分布$M$
- B: 服务时间分布：负指数分布 $M$
- C: 服务台数量：$1$-一个服务台, $C$ - 多个服务台
- D: 系统中信息包容量限制：$\infty$ - 没有限制, $N$ 有限制
- E: 信息源数目：$\infty$ - 没有限制, $N$ 有限制
- F: 服务规则: 先到先服务(FCFS)

Eg: $M/M/1/\infty/\infty/\text{FCFS}$

## 指标
- 状态概率分布 $P$: 系统中的信息包个数服从的分布 $P$
- 系统队长 $L$: 系统中平均信息包数量(期望)
- 排队长 $L_{q}$: 系统中平均等待的信息包数量(期望)
- 信息包平均停留时间 $W$
- 信息包平均等待时间 $W_{q}$

**Th-Little Formula**: 
$$\begin{align}
L=\lambda W\qquad
L_{q}=\lambda W_q\qquad
W=W_{q}+\cfrac{1}{\mu}\qquad
L=L_{q}+\cfrac{\lambda}{\mu}
\end{align}$$ 其中, 
- $\lambda$ 单位时间内信息包的平均到达率
- $\mu$ 单位时间服务台的平均服务率
- $\cfrac{1}{\lambda}$ 相邻两个顾客到达的平均间隔时间
- $\cfrac{1}{\mu}$ 对每个顾客的平均服务时间
- $\rho=\cfrac{\lambda}{\mu}$ 服务台的繁忙程度(服务台的利用系数)

# 马尔科夫排队模型
生灭过程: 每个细菌在时段 $\Delta t$ 内 ,
- 分裂的概率为 $\lambda\Delta t+o(\Delta t)$.
- 死亡的概率为 $\mu\Delta t+o(\Delta t)$.
- 不分裂也不死亡的概率: $1-(\lambda+\mu)\Delta t+o(\Delta t)$

各个细菌在任何时段中的分裂死亡相互独立。若将细菌的分裂和死亡看作一个事件, 则求任意时刻 $t$ 时细菌的总数 $X(t)$.

马尔科夫排队过程本质上就是带有生灭过程的排队系统.

**Def**: 在一个排队系统中, 在 $N(t)$ 为任意时刻 $t$ 排队系统的状态(当前系统的中信息包数量$n$)。 称满足以下生灭特征的排队模型称之为马尔科夫排队模型: $N(t)=n$
- 到下一个信息包到达的时间间隔服从参数 $\lambda_{n}$ 的负指数分布
- 到下一个信息包离开的时间间隔服从参数 $\mu_{n}$ 的负指数分布
- 同一时刻信息包只有离开或者到达两种情况

在排队模型中, 我们的核心目标是求状态平衡方程, 也就是系统中的信息包个数服从的分布 $P_{n}$ , 所谓平衡就是当 $t\to\infty$ 时, $\lim_{t\to\infty}P_{n}(t)=P_{n}$.

平衡状态: 对于任意状态 $n$, **"流入"="流出"**
![[马尔科夫排队模型的平稳状态.excalidraw|800]]
- 状态0：$P_{1}\mu_{1}=P_{0}\lambda_{0} \to P_{1}=\cfrac{\lambda_0}{\mu_{1}}P_{0}$
- 状态1：$P_{0}\lambda_{0}+P_{2}\mu_{2}=P_{1}\mu_{1}+P_{1}\lambda_{1}\to P_{2}=\cfrac{\lambda_{0}\lambda_{1}}{\mu_{1}\mu_{2}}P_{0}$
- 状态2：$P_{1}\lambda_{1}+P_{3}\mu_{3}=P_{2}\mu_{2}+P_{2}\lambda_{2}\to P_{3}=\cfrac{\lambda_{0}\lambda_{1}\lambda_{2}}{\mu_{1}\mu_{2}\mu_{3}}P_{0}$
- ......
- 状态n: $P_{n-1}\lambda_{n-1}+P_{n+1}\mu_{n+1}=P_{n}\mu_{n}+P_{n}\lambda_{n}\to P_{n}=\cfrac{\lambda_{0}\lambda_{1}...\lambda_{n-1}}{\mu_{1}\mu_{2}...\mu_{n-1}\mu_{n}}$

最终, 由于 $P_{0}+P_{1}+...+P_{n}=1$,
$$
P_{0}=\left( 1+\sum\limits_{n=1}^{\infty}\cfrac{\lambda_{0}...\lambda_{n-1}\lambda_{n}}{\mu_{1}...\mu_{n}\mu_{n+1}} \right)^{-1}
$$ 所以队长 $L=\sum\limits_{n=0}^{\infty}n\cdot P_{n}$.



# MM1 排队模型
$M/M/\infty/\infty/\text{FCFS}$ 模型，即 信息包到达的过程服从泊松流, 服务时间服从负指数分布，单服务台, 系统容量和顾客容量都是无穷, 先到先服务, 设单位时间信息平均到达率是 $\lambda$，单位时间内服务台平均服务率是 $\mu$.
![[MM1.excalidraw|800]]

这个模型是上述模型的一个特例, 我们很容易知道在这个模型中所有的 $\lambda_i$ 都相等记作 $\lambda$, 所有的 $\mu_i$ 都相等记作 $\mu$, 即 $\rho=\cfrac{\lambda}{\mu}$, 则带入上节公式, 得到
$$
P_{0}+\rho P_{0} + \rho^{2} P_{0}+...+\rho^{n}P_{0}=1
$$
接下来求 $P_{0}$:
由等比级数公式，$\cfrac{P_{0}(1-\rho^{n})}{1-\rho}=1$.
所以当 $n\to\infty$ 时, 得 $\cfrac{P}{1-\rho}=1$,默认了 $\rho$ 是小于1的, 因为如果 $\rho>1$ 则这个队就会变得无限长.
则 系统中没有信息包的概率是 $P_{0}=1-\rho$,
系统中有n个信息包的概率为 $P_{n}=\rho^{n}P_{0}=\rho^{n}(1-\rho)$.

队长 $L=\sum\limits_{n=0}^{\infty}nP_{n}=\sum\limits_{n=0}^{\infty}n\rho^{n}(1-\rho)=\cfrac{\rho}{1-\rho}$.

有了队长 $L$ 这样所有的指标都可以求出来.

- 信息到达之后必须等待K个信息的概率 $P(n>k)=1-P(n\le k)=1-\sum\limits_{n=0}^{k}P_{n}=\rho^{k+1}$
- 信息停留时间超过给定时间 $t$ 的概率 $\displaystyle P(T>t)=\int_{t}^{\infty}(\mu-\lambda)\exp\{-(\mu-\lambda)s\}\,\mathrm{d}s=\exp\{-(\mu-\lambda)t\}$. 其中积分内的式子就是参数为 $\mu-\lambda$ 的指数分布

# MMC 排队模型
$M/M/C/\infty/\infty/\text{FCFS}$
